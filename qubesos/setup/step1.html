<!DOCTYPE html>
<html lang="ja-JP">
<head>
	<meta charset="utf-8">
	<title>Qubes OS 非公式セットアップガイド Step1: インストール</title>
</head>

<body>
	<link rel="stylesheet" href="/css/main.css">

	<main>
		<h1>Qubes OS 非公式セットアップガイド Step1: インストール</h1>
		<p id="update_date">更新日: 2023/07/19</p>

		<section>
			<p>さて、Step0でインストールメディアの作成までできたことと思います。Step1では実際にコンピューターにQubes OSをインストールしていきます。ISOファイルの検証はしましたよね？やってない場合はStep0をもう一度やり直してください。</p>
			<p>このガイドではLenovo ThinkPad X270にQubes OSをインストールしていきます。</p>
		</section>

		<section>
			<h2>BIOSの設定を変更する</h2>
			<p>Qubes OSはCPUの仮想化支援機能を使用しています。この機能は最近のコンピューターですと大抵オンになっているのですが、モデルによってはオフのものもあるようなのでBIOSの設定画面からオンになっているか確認しておきましょう。Intel VTやIntel VT-d、AMDですとIOMMUなどの名前になっているようです。ついでにQubes OSは現状セキュアブート非対応なのでセキュアブートもオフにします。その他にもネットワークスタックや使用しないペリフェラルなどもオフにしておきましょう。</p>
			<p>起動モードも確認しておきましょう。Qubes OSはUEFIブートに対応しているので、UEFI対応のコンピューターではレガシーBIOS互換のモードではなくUEFIネイティブの起動ができるように設定することを推奨します。</p>
		</section>

		<section>
			<h2>インストールを開始する</h2>
			<p>ではいよいよインストール開始です。インストールメディアを接続し、コンピューターを起動します。メーカー毎に決まっているブートメニューを表示するキー（LenovoはF12）を押して、インストールメディアから起動するように指定します。成功すれば次のような画面が表示されます。</p>
			<img src="/qubesos/setup/img/grub.jpg">
			<p>Install Qubes OS R4.2.0-rc1を選択します。最新モデルのコンピューターを使用しているなど、この方法でうまく動作しない場合は一番下のInstall Qubes OS R4.2.0-rc1 using kernel-latestを選択してみてください。選択してEnterを押すとインストーラーの起動処理が始まります。起動処理が終わると言語選択画面が表示されます。</p>
			<img src="/qubesos/setup/img/lang.jpg">
			<p>日本語を選択して右下の続行ボタンを押します。すると設定項目の一覧画面が表示されます。まず、最初にタイムゾーンを選択します。日付と時刻をクリックして、</p>
			<img src="/qubesos/setup/img/timezone.jpg">
			<p>世界地図の日本をクリックします。すると地域：アジア、都市：東京がセットされるので、完了ボタンを押します。</p>
			<p>次はインストール先をクリックします。インストール先デバイスの選択画面が表示されるので、</p>
			<img src="/qubesos/setup/img/disk1.jpg">
			<p>ストレージの設定→カスタムを選択し、完了をクリックします。するとパーティションの選択画面が表示されます。標準ではLVMシンプロビジョニングが使用されるのですが、せっかくなのでBTRFSでセットアップします。BTRFSの構成もサポートされているので安心してください。</p>
			<img src="/qubesos/setup/img/disk2.jpg">
			<p>BTRFSを選択し、データを暗号化するにチェックを入れます。（暗号化は当然ですよね？）次は、既存の不要なパーティションを全て削除します。不明というところをクリックしてパーティションのリストを表示し、左下のマイナスボタンでパーティションを削除していきます。</p>
			<img src="/qubesos/setup/img/disk3.jpg">
			<p>すべてのパーティションを削除すれば、左下の使用できる領域とすべての領域の値が一致するはずです。</p>
			<img src="/qubesos/setup/img/disk4.jpg">
			<p>さて、不要なパーティションの削除が終わったのでQubes用のパーティションを作成しましょう。「ここをクリックすると自動的に作成します」をクリックして、パーティションを作成してください。作成ができると次のような画面になります。</p>
			<img src="/qubesos/setup/img/disk5.jpg">
			<p>左上の完了を押すとディスク暗号化のパスワード入力画面が表示されます。十分な長さで推測されない強力なパスワードを入力しましょう。著者のメインPCはパスワード120桁です。</p>
			<img src="/qubesos/setup/img/disk6.jpg">
			<p>最後に最終確認画面が出るのでOKして次はユーザー作成を行います。ユーザーの作成をクリックして、</p>
			<img src="/qubesos/setup/img/user.jpg">
			<p>ユーザー名とパスワードを入力してください。紛らわしいのですが、このパスワードはロック画面を解除する際に使用するパスワードで、ディスク暗号化のパスワードとは別の物です。こちらは程々の強度のもので構いません。フルネームは空欄、ユーザー名はOPSECの観点から「user」などが好ましいと思います。</p>
			<p>さて、設定の第一段階が終わりました。rootアカウントは無効のままで構いませんし、その他にも触れてない設定項目はデフォルトのままで問題ないでしょう。設定が終わると次のような状態になっているはずです。</p>
			<img src="/qubesos/setup/img/config.jpg">
			<p>設定が終わったことを確認したら、インストールの開始をクリックしましょう。インストールにはしばらくかかるので、休憩を取るのもよいでしょう。インストールが終わると再起動ボタンが押せるようになるので押して再起動します。インストール用メディアは不要なので取り外して構いません。</p>
			<p>再起動後はディスク暗号化のパスワード入力画面が現れるので、パスワードを入力してください。入力して少し待つと、第二段階の設定画面が表示されます。</p>
			<img src="/qubesos/setup/img/final.jpg">
			<p>中央のQubes OSというところをクリックしてください。次のような画面になるはずです。</p>
			<img src="/qubesos/setup/img/final2.jpg">
		</section>
	</main>

	<footer>
		<a href="/about">このWebサイトについて</a>
	</footer>
</body>
</html>
